<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>نظام بلايستيشن ومشروبات</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Tajawal', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      width: 100%;
      text-align: center;
      color: #00d4ff;
      font-size: 2.5rem;
      font-weight: 900;
      margin: 20px 0;
      text-shadow: 0 0 15px #00d4ffaa;
    }
    
    .rooms-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1400px;
      margin-bottom: 30px;
    }
    
    .room-card {
      background: rgba(15, 32, 39, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      box-shadow: 0 0 20px #00d4ff88;
      display: flex;
      flex-direction: column;
      padding: 20px;
      position: relative;
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 212, 255, 0.3);
      height: 100%;
    }
    .room-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 30px #00d4ffaa;
    }
    .room-header {
      font-size: 1.8rem;
      font-weight: 900;
      color: #00d4ff;
      margin-bottom: 15px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .status {
      position: absolute;
      top: 15px;
      left: 15px;
      font-weight: 700;
      font-size: 0.9rem;
      padding: 5px 10px;
      border-radius: 10px;
      user-select: none;
      box-shadow: 0 0 8px #000;
      transition: all 0.4s ease;
    }
    .status.offline {
      background-color: #666;
      color: #bbb;
    }
    .status.online {
      background-color: #00d4ff;
      color: #0f2027;
      box-shadow: 0 0 12px #00d4ffbb;
    }
    
    .timer-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 2.5rem;
      font-weight: 900;
      color: #00d4ff;
      text-align: center;
      font-family: 'Courier New', Courier, monospace;
      letter-spacing: 3px;
      text-shadow: 0 0 10px #00d4ff88;
      user-select: none;
      line-height: 1;
    }
    
    .price {
      font-size: 1.3rem;
      font-weight: 800;
      color: #00d4ff;
      text-align: center;
      margin-bottom: 10px;
      user-select: none;
    }
    
    .drinks-list {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      max-height: 120px;
      overflow-y: auto;
    }
    
    .drink-item {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid rgba(0, 212, 255, 0.2);
      font-size: 0.9rem;
    }
    
    .drink-item:last-child {
      border-bottom: none;
    }
    
    .drinks-total {
      font-size: 1.1rem;
      font-weight: 700;
      color: #00d4ff;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    button {
      flex: 1;
      min-width: 120px;
      padding: 10px 0;
      border-radius: 10px;
      border: none;
      font-weight: 800;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      box-shadow: 0 0 6px #000;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
      transform: none !important;
    }
    button.start {
      background-color: #00d4ff;
      color: #0f2027;
    }
    button.start:hover:not(:disabled) {
      background-color: #00e5ff;
      transform: translateY(-2px);
    }
    button.end {
      background-color: #ff4757;
      color: #fff;
    }
    button.end:hover:not(:disabled) {
      background-color: #ff6b81;
      transform: translateY(-2px);
    }
    button.drinks {
      background-color: #f39c12;
      color: #fff;
    }
    button.drinks:hover:not(:disabled) {
      background-color: #f1c40f;
      transform: translateY(-2px);
    }
    button.print {
      background-color: #2c5364;
      color: #ddd;
      font-weight: 700;
    }
    button.print:hover {
      background-color: #3a7188;
      transform: translateY(-2px);
    }
    
    .summary-btn {
      background-color: #00d4ff;
      color: #0f2027;
      padding: 12px 25px;
      border-radius: 12px;
      font-weight: 800;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .summary-btn:hover {
      background-color: #00e5ff;
      transform: translateY(-2px);
    }
    
    /* Menu Modal */
    .menu-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1001;
      backdrop-filter: blur(5px);
    }
    
    .menu-content {
      background: #0f2027;
      padding: 20px;


      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 30px #00d4ffaa;
      border: 1px solid #00d4ff;
    }
    
    .menu-category {
      margin-bottom: 20px;
    }
    
    .menu-category h3 {
      color: #00d4ff;
      margin-bottom: 10px;
      font-size: 1.3rem;
      border-bottom: 2px solid #00d4ff;
      padding-bottom: 5px;
    }
    
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin-bottom: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .menu-item:hover {
      background: rgba(0, 212, 255, 0.2);
      transform: translateX(-5px);
    }
    
    .menu-item-price {
      color: #00d4ff;
      font-weight: bold;
    }
    
    .menu-item-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .menu-item-controls button {
      min-width: 30px;
      padding: 5px;
      font-size: 1rem;
      border-radius: 5px;
    }
    
    .menu-item-controls .plus {
      background-color: #00d4ff;
      color: #0f2027;
    }
    .menu-item-controls .plus:hover {
      background-color: #00e5ff;
    }
    .menu-item-controls .minus {
      background-color: #ff4757;
      color: #fff;
    }
    .menu-item-controls .minus:hover {
      background-color: #ff6b81;
    }
    
    .menu-item-controls span {
      color: #fff;
      font-weight: bold;
      min-width: 30px;
      text-align: center;
    }
    
    .close-menu {
      background: #ff4757;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      margin-top: 20px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    
    /* Login Form */
    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }
    
    .login-form {
      background: #0f2027;
      padding: 30px;
      border-radius: 15px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 30px #00d4ffaa;
      border: 1px solid #00d4ff;
    }
    
    .login-form h2 {
      color: #00d4ff;
      text-align: center;
      margin-bottom: 25px;
      font-size: 1.8rem;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #00d4ff;
      font-weight: bold;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid #00d4ff;
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-size: 1rem;
    }
    
    .login-btn {
      width: 100%;
      padding: 12px;
      background: #00d4ff;
      color: #0f2027;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    .login-btn:hover {
      background: #00e5ff;
      transform: translateY(-2px);
    }
    
    /* Print styles */
    @media print {
      body {
        background: white;
        color: black;
      }
      body * {
        visibility: hidden;
      }
      .print-content, .print-content * {
        visibility: visible !important;
        color: black !important;
      }
      .print-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: auto;
        background: white;
        color: black;
        padding: 20px;
        font-family: 'Tajawal', Arial, sans-serif;
        font-size: 12pt;
      }
      .print-header {
        text-align: center;
        margin-bottom: 20px;
      }
      .print-header h2 {
        color: #0f2027;
        font-size: 18pt;
        margin-bottom: 10px;
      }
      .print-details {
        font-size: 12pt;
        margin: 15px 0;
      }
      .print-details p {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
      }
      .print-details span {
        font-weight: bold;
        color: #0f2027;
      }
      .print-divider {
        height: 2px;
        background: linear-gradient(90deg, transparent, #0f2027, transparent);
        margin: 15px 0;
      }
      .print-footer {
        text-align: center;
        margin-top: 25px;
        font-size: 10pt;
        color: #666;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      .rooms-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Login Form -->
  <div id="loginContainer" class="login-container">
    <div class="login-form">
      <h2><i class="fas fa-lock"></i> تسجيل الدخول</h2>
      <form onsubmit="event.preventDefault(); login();">
        <div class="form-group">
          <label for="email">اسم المستخدم</label>
          <input type="text" id="email" placeholder="أدخل اسم المستخدم" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="password">كلمة المرور</label>
          <input type="password" id="password" placeholder="أدخل كلمة المرور" required autocomplete="current-password">
        </div>
        <button type="submit" class="login-btn"><i class="fas fa-sign-in-alt"></i> دخول</button>
      </form>
    </div>
  </div>

  <!-- Main Content (Hidden until login) -->
  <div id="mainContent" style="display: none;">
    <h1><i class="fas fa-gamepad"></i> نظام بلايستيشن ومشروبات</h1>

    <div class="rooms-container">
      <div class="room-card" id="room1">
        <div class="status offline" id="status1">متوقفة</div>
        <h2 class="room-header"><i class="fas fa-door-open"></i> غرفة 1</h2>
        <div class="timer-container">
          <div class="timer" id="timer1">00:00:00</div>
        </div>
        <div class="price" id="price1">0.00 جنيه</div>
        <div class="drinks-list" id="drinksList1"></div>
        <div class="drinks-total" id="drinksTotal1">المشروبات: 0.00 جنيه</div>
        <div class="buttons">
          <button class="start" id="start1" onclick="startTimer(1)"><i class="fas fa-play"></i> ابدأ</button>
          <button class="end" id="end1" onclick="endTimer(1)" disabled><i class="fas fa-stop"></i> إنهاء</button>
          <button class="drinks" id="drinks1" onclick="openDrinksMenu(1)" disabled><i class="fas fa-glass-whiskey"></i> مشروبات</button>
          <button class="print" onclick="printInvoice(1)"><i class="fas fa-print"></i> طباعة</button>
        </div>
      </div>

      <div class="room-card" id="room2">
        <div class="status offline" id="status2">متوقفة</div>
        <h2 class="room-header"><i class="fas fa-door-open"></i> غرفة 2</h2>
        <div class="timer-container">
          <div class="timer" id="timer2">00:00:00</div>
        </div>
        <div class="price" id="price2">0.00 جنيه</div>
        <div class="drinks-list" id="drinksList2"></div>
        <div class="drinks-total" id="drinksTotal2">المشروبات: 0.00 جنيه</div>
        <div class="buttons">
          <button class="start" id="start2" onclick="startTimer(2)"><i class="fas fa-play"></i> ابدأ</button>
          <button class="end" id="end2" onclick="endTimer(2)" disabled><i class="fas fa-stop"></i> إنهاء</button>
          <button class="drinks" id="drinks2" onclick="openDrinksMenu(2)" disabled><i class="fas fa-glass-whiskey"></i> مشروبات</button>
          <button class="print" onclick="printInvoice(2)"><i class="fas fa-print"></i> طباعة</button>
        </div>
      </div>

      <div class="room-card" id="room3">
        <div class="status offline" id="status3">متوقفة</div>
        <h2 class="room-header"><i class="fas fa-door-open"></i> غرفة 3</h2>
        <div class="timer-container">
          <div class="timer" id="timer3">00:00:00</div>
        </div>
        <div class="price" id="price3">0.00 جنيه</div>
        <div class="drinks-list" id="drinksList3"></div>
        <div class="drinks-total" id="drinksTotal3">المشروبات: 0.00 جنيه</div>
        <div class="buttons">
          <button class="start" id="start3" onclick="startTimer(3)"><i class="fas fa-play"></i> ابدأ</button>
          <button class="end" id="end3" onclick="endTimer(3)" disabled><i class="fas fa-stop"></i> إنهاء</button>
          <button class="drinks" id="drinks3" onclick="openDrinksMenu(3)" disabled><i class="fas fa-glass-whiskey"></i> مشروبات</button>
          <button class="print" onclick="printInvoice(3)"><i class="fas fa-print"></i> طباعة</button>
        </div>
      </div>

      <div class="room-card" id="room4">
        <div class="status offline" id="status4">متوقفة</div>
        <h2 class="room-header"><i class="fas fa-door-open"></i> غرفة 4</h2>
        <div class="timer-container">
          <div class="timer" id="timer4">00:00:00</div>
        </div>
        <div class="price" id="price4">0.00 جنيه</div>
        <div class="drinks-list" id="drinksList4"></div>
        <div class="drinks-total" id="drinksTotal4">المشروبات: 0.00 جنيه</div>
        <div class="buttons">
          <button class="start" id="start4" onclick="startTimer(4)"><i class="fas fa-play"></i> ابدأ</button>
          <button class="end" id="end4" onclick="endTimer(4)" disabled><i class="fas fa-stop"></i> إنهاء</button>
          <button class="drinks" id="drinks4" onclick="openDrinksMenu(4)" disabled><i class="fas fa-glass-whiskey"></i> مشروبات</button>
          <button class="print" onclick="printInvoice(4)"><i class="fas fa-print"></i> طباعة</button>
        </div>
      </div>
    </div>

    <button class="summary-btn" onclick="showDailySummary()">
      <i class="fas fa-calculator"></i> إجمالي اليوم
    </button>

    <!-- Drinks Menu Modal -->
    <div id="drinksModal" class="menu-modal">
      <div class="menu-content">
        <h2 style="color: #f39c12; text-align: center; margin-bottom: 20px;"><i class="fas fa-glass-whiskey"></i> قائمة المشروبات</h2>
        <div class="menu-category">
          <h3>المشروبات الغازية</h3>
          <div class="menu-item" data-drink="كولا" data-price="15">
            <span>كولا</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('كولا', -1)">−</button>
              <span id="quantity-كولا">0</span>
              <button class="plus" onclick="updateDrinkQuantity('كولا', 1)">+</button>
            </div>
            <span class="menu-item-price">15 جنيه</span>
          </div>
          <div class="menu-item" data-drink="سفن أب" data-price="15">
            <span>سفن أب</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('سفن أب', -1)">−</button>
              <span id="quantity-سفن أب">0</span>
              <button class="plus" onclick="updateDrinkQuantity('سفن أب', 1)">+</button>
            </div>
            <span class="menu-item-price">15 جنيه</span>
          </div>
          <div class="menu-item" data-drink="فانتا" data-price="15">
            <span>فانتا</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('فانتا', -1)">−</button>
              <span id="quantity-فانتا">0</span>
              <button class="plus" onclick="updateDrinkQuantity('فانتا', 1)">+</button>
            </div>
            <span class="menu-item-price">15 جنيه</span>
          </div>
        </div>
        <div class="menu-category">
          <h3>العصائر</h3>
          <div class="menu-item" data-drink="عصير برتقال" data-price="20">
            <span>عصير برتقال</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('عصير برتقال', -1)">−</button>
              <span id="quantity-عصير برتقال">0</span>
              <button class="plus" onclick="updateDrinkQuantity('عصير برتقال', 1)">+</button>
            </div>
            <span class="menu-item-price">20 جنيه</span>
          </div>
          <div class="menu-item" data-drink="عصير مانجو" data-price="25">
            <span>عصير مانجو</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('عصير مانجو', -1)">−</button>
              <span id="quantity-عصير مانجو">0</span>
              <button class="plus" onclick="updateDrinkQuantity('عصير مانجو', 1)">+</button>
            </div>
            <span class="menu-item-price">25 جنيه</span>
          </div>
          <div class="menu-item" data-drink="عصير فراولة" data-price="25">
            <span>عصير فراولة</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('عصير فراولة', -1)">−</button>
              <span id="quantity-عصير فراولة">0</span>
              <button class="plus" onclick="updateDrinkQuantity('عصير فراولة', 1)">+</button>
            </div>
            <span class="menu-item-price">25 جنيه</span>
          </div>
        </div>
        <div class="menu-category">
          <h3>المشروبات الساخنة</h3>
          <div class="menu-item" data-drink="شاي" data-price="10">
            <span>شاي</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('شاي', -1)">−</button>
              <span id="quantity-شاي">0</span>
              <button class="plus" onclick="updateDrinkQuantity('شاي', 1)">+</button>
            </div>
            <span class="menu-item-price">10 جنيه</span>
          </div>
          <div class="menu-item" data-drink="قهوة" data-price="15">
            <span>قهوة</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('قهوة', -1)">−</button>
              <span id="quantity-قهوة">0</span>
              <button class="plus" onclick="updateDrinkQuantity('قهوة', 1)">+</button>
            </div>
            <span class="menu-item-price">15 جنيه</span>
          </div>
          <div class="menu-item" data-drink="كابتشينو" data-price="20">
            <span>كابتشينو</span>
            <div class="menu-item-controls">
              <button class="minus" onclick="updateDrinkQuantity('كابتشينو', -1)">−</button>
              <span id="quantity-كابتشينو">0</span>
              <button class="plus" onclick="updateDrinkQuantity('كابتشينو', 1)">+</button>
            </div>
            <span class="menu-item-price">20 جنيه</span>
          </div>
        </div>
        <button class="close-menu" onclick="closeDrinksMenu()"><i class="fas fa-times"></i> إغلاق القائمة</button>
      </div>
    </div>

    <!-- Hidden print content -->
    <div id="printContent" class="print-content" style="display: none;">
      <div class="print-header">
        <h2><i class="fas fa-receipt"></i> فاتورة بلايستيشن ومشروبات</h2>
        <p>نظام إدارة صالات الألعاب</p>
      </div>
      <div class="print-details">
        <p>رقم الغرفة: <span id="printRoom">1</span></p>
        <p>وقت اللعب: <span id="printTime">00:00:00</span></p>
        <p>سعر الساعة: <span id="printRate">10.00 جنيه</span></p>
        <p>إجمالي الوقت: <span id="printTimeTotal">0.00 جنيه</span></p>
        <div id="printDrinks">
          <p style="font-weight: bold; margin-top: 15px;">المشروبات:</p>
        </div>
        <div class="print-divider"></div>
        <p>المبلغ المستحق: <span id="printTotal">0.00 جنيه</span></p>
        <p>تاريخ الطباعة: <span id="printDate">--/--/---- --:--</span></p>
      </div>
      <div class="print-footer">
        <p>شكراً لزيارتكم - نتمنى لكم وقتاً ممتعاً</p>
        <p>للاستفسار: 0123456789</p>
      </div>
    </div>

    <!-- Daily Summary Modal -->
    <div id="summaryModal" class="menu-modal" style="display: none;">
      <div class="menu-content">
        <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 1.8rem;"><i class="fas fa-coins"></i> إجمالي اليوم</h2>
        <div id="summaryContent" style="font-size: 1.2rem; margin-bottom: 25px; line-height: 1.6;"></div>
        <div style="display: flex; gap: 10px;">
          <button onclick="resetDailyEarnings()" style="background: #ff4757; color: #fff; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem;">
            <i class="fas fa-redo"></i> إعادة تعيين اليوم
          </button>
          <button onclick="document.getElementById('summaryModal').style.display = 'none'" style="background: #00d4ff; color: #0f2027; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem;">
            <i class="fas fa-times"></i> إغلاق
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const ADMIN_CREDENTIALS = [
      { username: "pro.antiban", password: "12345pro" },
      { username: "pro.antiban2", password: "12345678pro" }
    ];
    const HOUR_RATE = 10; // 10 جنيه لكل ساعة
    const rooms = 4; // عدد الغرف
    
    // Initialize timers and states
    let currentRoom = 1;
    let timers = {};
    let startTimes = {};
    let timePrices = {};
    let drinks = {};
    let drinksPrices = {};
    let dailyTimeEarnings = {};
    let dailyDrinksEarnings = {};
    let drinkQuantities = {};
    
    for (let i = 1; i <= rooms; i++) {
      timers[i] = null;
      startTimes[i] = null;
      timePrices[i] = 0;
      drinks[i] = [];
      drinksPrices[i] = 0;
      dailyTimeEarnings[i] = 0;
      dailyDrinksEarnings[i] = 0;
      drinkQuantities[i] = {
        'كولا': 0, 'سفن أب': 0, 'فانتا': 0,
        'عصير برتقال': 0, 'عصير مانجو': 0, 'عصير فراولة': 0,
        'شاي': 0, 'قهوة': 0, 'كابتشينو': 0
      };
    }
    
    // Login function with single-use email check
    function login() {
      const username = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      
      // Check if email was used before
      const usedEmails = JSON.parse(localStorage.getItem('usedEmails') || '[]');
      if (usedEmails.includes(username)) {
        alert('هذا البريد الإلكتروني تم استخدامه بالفعل!');
        return;
      }
      
      // Check credentials
      const validCredential = ADMIN_CREDENTIALS.find(
        cred => cred.username === username && cred.password === password
      );
      
      if (validCredential) {
        // Store login state and email
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('loggedInUser', username);
        usedEmails.push(username);
        localStorage.setItem('usedEmails', JSON.stringify(usedEmails));
        
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        saveData();
      } else {
        alert('اسم المستخدم أو كلمة المرور غير صحيحة');
      }
    }
    
    // Check login state on page load
    function checkLoginState() {
      const isLoggedIn = localStorage.getItem('isLoggedIn');
      if (isLoggedIn === 'true') {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        loadData();
      }
    }
    
    // Start timer function
    function startTimer(roomNum) {
      if (timers[roomNum]) return;
      
      document.getElementById(`status${roomNum}`).className = 'status online';
      document.getElementById(`status${roomNum}`).textContent = 'شغالة';
      document.getElementById(`start${roomNum}`).disabled = true;
      document.getElementById(`end${roomNum}`).disabled = false;
      document.getElementById(`drinks${roomNum}`).disabled = false;
      
      startTimes[roomNum] = new Date();
      timers[roomNum] = setInterval(() => {
        updateTimer(roomNum);
      }, 1000);
      
      saveData();
      playSound('start');
    }
    
    // End timer function with full reset
    function endTimer(roomNum) {
      if (!timers[roomNum]) return;
      
      if (confirm(`هل تريد إنهاء جلسة غرفة ${roomNum}؟`)) {
        clearInterval(timers[roomNum]);
        timers[roomNum] = null;
        
        document.getElementById(`status${roomNum}`).className = 'status offline';
        document.getElementById(`status${roomNum}`).textContent = 'متوقفة';
        document.getElementById(`start${roomNum}`).disabled = false;
        document.getElementById(`end${roomNum}`).disabled = true;
        document.getElementById(`drinks${roomNum}`).disabled = true;
        
        updateTimer(roomNum);
        
        dailyTimeEarnings[roomNum] += timePrices[roomNum];
        dailyDrinksEarnings[roomNum] += drinksPrices[roomNum];
        
        const total = timePrices[roomNum] + drinksPrices[roomNum];
        alert(`إجمالي غرفة ${roomNum}:
        الوقت: ${timePrices[roomNum].toFixed(2)} جنيه
        المشروبات: ${drinksPrices[roomNum].toFixed(2)} جنيه
        الإجمالي: ${total.toFixed(2)} جنيه`);
        
        resetRoom(roomNum);
        saveData();
        playSound('end');
      }
    }
    
    // Update timer display and calculate price
    function updateTimer(roomNum) {
      if (!startTimes[roomNum]) return;
      
      const now = new Date();
      const diff = now - startTimes[roomNum]; // milliseconds
      
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      const formattedTime = 
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      document.getElementById(`timer${roomNum}`).textContent = formattedTime;
      
      const hoursPlayed = diff / (1000 * 60 * 60);
      timePrices[roomNum] = Math.round(hoursPlayed * HOUR_RATE * 100) / 100;
      
      document.getElementById(`price${roomNum}`).textContent = `${timePrices[roomNum].toFixed(2)} جنيه`;
    }
    
    // Open drinks menu
    function openDrinksMenu(roomNum) {
      currentRoom = roomNum;
      resetDrinkQuantities();
      updateDrinkQuantitiesDisplay();
      document.getElementById('drinksModal').style.display = 'flex';
      playSound('drink');
    }
    
    // Close drinks menu
    function closeDrinksMenu() {
      updateDrinksFromQuantities();
      updateDrinksDisplay(currentRoom);
      saveData();
      document.getElementById('drinksModal').style.display = 'none';
    }
    
    // Update drink quantity
    function updateDrinkQuantity(drinkName, change) {
      if (!currentRoom) return;
      const newQuantity = Math.max(0, (drinkQuantities[currentRoom][drinkName] || 0) + change);
      drinkQuantities[currentRoom][drinkName] = newQuantity;
      document.getElementById(`quantity-${drinkName}`).textContent = newQuantity;
      playSound('drink');
    }
    
    // Update drinks from quantities
    function updateDrinksFromQuantities() {
      if (!currentRoom) return;
      drinks[currentRoom] = [];
      drinksPrices[currentRoom] = 0;
      
      const drinkPrices = {
        'كولا': 15, 'سفن أب': 15, 'فانتا': 15,
        'عصير برتقال': 20, 'عصير مانجو': 25, 'عصير فراولة': 25,
        'شاي': 10, 'قهوة': 15, 'كابتشينو': 20
      };
      
      for (const [drink, quantity] of Object.entries(drinkQuantities[currentRoom])) {
        if (quantity > 0) {
          for (let i = 0; i < quantity; i++) {
            drinks[currentRoom].push({ name: drink, price: drinkPrices[drink] });
            drinksPrices[currentRoom] += drinkPrices[drink];
          }
        }
      }
    }
    
    // Reset drink quantities display
    function resetDrinkQuantities() {
      if (!currentRoom) return;
      const drinkNames = ['كولا', 'سفن أب', 'فانتا', 'عصير برتقال', 'عصير مانجو', 'عصير فراولة', 'شاي', 'قهوة', 'كابتشينو'];
      drinkNames.forEach(drink => {
        drinkQuantities[currentRoom][drink] = drinks[currentRoom].filter(item => item.name === drink).length;
      });
    }
    
    // Update drink quantities display
    function updateDrinkQuantitiesDisplay() {
      if (!currentRoom) return;
      for (const [drink, quantity] of Object.entries(drinkQuantities[currentRoom])) {
        const element = document.getElementById(`quantity-${drink}`);
        if (element) {
          element.textContent = quantity;
        }
      }
    }
    
    // Update drinks display
    function updateDrinksDisplay(roomNum) {
      const drinksList = document.getElementById(`drinksList${roomNum}`);
      drinksList.innerHTML = '';
      
      const drinkSummary = {};
      drinks[roomNum].forEach(item => {
        drinkSummary[item.name] = (drinkSummary[item.name] || 0) + 1;
      });
      
      for (const [name, quantity] of Object.entries(drinkSummary)) {
        const drinkPrice = drinks[roomNum].find(item => item.name === name).price;
        const drinkItem = document.createElement('div');
        drinkItem.className = 'drink-item';
        drinkItem.innerHTML = `
          <span>${name} (x${quantity})</span>
          <span>${(drinkPrice * quantity).toFixed(2)} جنيه</span>
        `;
        drinksList.appendChild(drinkItem);
      }
      
      document.getElementById(`drinksTotal${roomNum}`).textContent = `المشروبات: ${drinksPrices[roomNum].toFixed(2)} جنيه`;
    }
    
    // Reset room
    function resetRoom(roomNum) {
      timers[roomNum] = null;
      startTimes[roomNum] = null;
      timePrices[roomNum] = 0;
      drinks[roomNum] = [];
      drinksPrices[roomNum] = 0;
      drinkQuantities[roomNum] = {
        'كولا': 0, 'سفن أب': 0, 'فانتا': 0,
        'عصير برتقال': 0, 'عصير مانجو': 0, 'عصير فراولة': 0,
        'شاي': 0, 'قهوة': 0, 'كابتشينو': 0
      };
      
      document.getElementById(`timer${roomNum}`).textContent = '00:00:00';
      document.getElementById(`price${roomNum}`).textContent = '0.00 جنيه';
      document.getElementById(`drinksList${roomNum}`).innerHTML = '';
      document.getElementById(`drinksTotal${roomNum}`).textContent = 'المشروبات: 0.00 جنيه';
    }
    
    // Print invoice
    function printInvoice(roomNum) {
      if (timePrices[roomNum] <= 0 && drinksPrices[roomNum] <= 0) {
        alert('لا يوجد مشتريات لطباعة الفاتورة');
        return;
      }
      
      if (confirm(`هل تريد طباعة فاتورة غرفة ${roomNum}؟`)) {
        // Log data for debugging
        console.log('Printing invoice for room:', roomNum);
        console.log('Time Price:', timePrices[roomNum]);
        console.log('Drinks:', drinks[roomNum]);
        console.log('Drinks Price:', drinksPrices[roomNum]);
        
        const now = new Date();
        const dateStr = now.toLocaleDateString('ar-EG', { year: 'numeric', month: '2-digit', day: '2-digit' }) + ' ' + 
                        now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
        
        // Populate print content
        document.getElementById('printRoom').textContent = roomNum;
        document.getElementById('printTime').textContent = document.getElementById(`timer${roomNum}`).textContent;
        document.getElementById('printRate').textContent = `${HOUR_RATE.toFixed(2)} جنيه`;
        document.getElementById('printTimeTotal').textContent = `${timePrices[roomNum].toFixed(2)} جنيه`;
        
        const printDrinks = document.getElementById('printDrinks');
        printDrinks.innerHTML = '<p style="font-weight: bold; margin-top: 15px;">المشروبات:</p>';
        
        if (drinks[roomNum].length === 0) {
          const noDrinks = document.createElement('p');
          noDrinks.textContent = 'لا توجد مشروبات';
          printDrinks.appendChild(noDrinks);
        } else {
          const drinkSummary = {};
          drinks[roomNum].forEach(item => {
            drinkSummary[item.name] = (drinkSummary[item.name] || 0) + 1;
          });
          
          for (const [name, quantity] of Object.entries(drinkSummary)) {
            const drinkPrice = drinks[roomNum].find(item => item.name === name).price;
            const drinkRow = document.createElement('p');
            drinkRow.innerHTML = `
              <span>${name} (x${quantity})</span>
              <span>${(drinkPrice * quantity).toFixed(2)} جنيه</span>
            `;
            printDrinks.appendChild(drinkRow);
          }
        }
        
        const total = timePrices[roomNum] + drinksPrices[roomNum];
        document.getElementById('printTotal').textContent = `${total.toFixed(2)} جنيه`;
        document.getElementById('printDate').textContent = dateStr;
        
        // Ensure print content is visible and force DOM update
        const printContent = document.getElementById('printContent');
        printContent.style.display = 'block';
        
        // Log print content for debugging
        console.log('Print Content HTML:', printContent.innerHTML);
        
        // Delay print to ensure DOM is updated
        setTimeout(() => {
          window.print();
          printContent.style.display = 'none';
        }, 100);
      }
    }
    
    // Show daily summary
    function showDailySummary() {
      let timeTotal = 0;
      let drinksTotal = 0;
      let summaryHTML = '';
      
      for (let i = 1; i <= rooms; i++) {
        timeTotal += dailyTimeEarnings[i];
        drinksTotal += dailyDrinksEarnings[i];
        summaryHTML += `
          <p>غرفة ${i}: 
            <span style="color: #00d4ff;">${dailyTimeEarnings[i].toFixed(2)}</span> (وقت) + 
            <span style="color: #f39c12;">${dailyDrinksEarnings[i].toFixed(2)}</span> (مشروبات) = 
            <span style="font-weight: bold;">${(dailyTimeEarnings[i] + dailyDrinksEarnings[i]).toFixed(2)} جنيه</span>
          </p>`;
      }
      
      const grandTotal = timeTotal + drinksTotal;
      summaryHTML += `
        <div style="margin: 20px 0; height: 2px; background: linear-gradient(90deg, transparent, #00d4ff, transparent);"></div>
        <p>إجمالي الوقت: <span style="color: #00d4ff; font-weight: bold;">${timeTotal.toFixed(2)} جنيه</span></p>
        <p>إجمالي المشروبات: <span style="color: #f39c12; font-weight: bold;">${drinksTotal.toFixed(2)} جنيه</span></p>
        <p>الإجمالي الكلي: <span style="color: #00ff85; font-weight: bold;">${grandTotal.toFixed(2)} جنيه</span></p>
      `;
      
      document.getElementById('summaryContent').innerHTML = summaryHTML;
      document.getElementById('summaryModal').style.display = 'flex';
    }
    
    // Reset daily earnings
    function resetDailyEarnings() {
      if (confirm('هل تريد إعادة تعيين إجمالي اليوم؟')) {
        for (let i = 1; i <= rooms; i++) {
          dailyTimeEarnings[i] = 0;
          dailyDrinksEarnings[i] = 0;
        }
        saveData();
        alert('تم إعادة تعيين إجمالي اليوم');
        document.getElementById('summaryModal').style.display = 'none';
      }
    }
    
    // Save data to localStorage
    function saveData() {
      const data = {
        dailyTimeEarnings,
        dailyDrinksEarnings,
        timers,
        startTimes,
        timePrices,
        drinks,
        drinksPrices,
        drinkQuantities
      };
      localStorage.setItem('playstationData', JSON.stringify(data));
    }
    
    // Load data from localStorage
    function loadData() {
      const data = localStorage.getItem('playstationData');
      if (data) {
        const parsed = JSON.parse(data);
        dailyTimeEarnings = parsed.dailyTimeEarnings || dailyTimeEarnings;
        dailyDrinksEarnings = parsed.dailyDrinksEarnings || dailyDrinksEarnings;
        drinkQuantities = parsed.drinkQuantities || drinkQuantities;
        
        for (let i = 1; i <= rooms; i++) {
          if (parsed.startTimes[i]) {
            startTimes[i] = new Date(parsed.startTimes[i]);
            timePrices[i] = parsed.timePrices[i] || 0;
            drinks[i] = parsed.drinks[i] || [];
            drinksPrices[i] = parsed.drinksPrices[i] || 0;
            
            if (startTimes[i]) {
              document.getElementById(`status${i}`).className = 'status online';
              document.getElementById(`status${i}`).textContent = 'شغالة';
              document.getElementById(`start${i}`).disabled = true;
              document.getElementById(`end${i}`).disabled = false;
              document.getElementById(`drinks${i}`).disabled = false;
              
              timers[i] = setInterval(() => updateTimer(i), 1000);
              updateDrinksDisplay(i);
            }
          }
        }
      }
    }
    
    // Sound feedback
    function playSound(action) {
      const sounds = {
        start: new Audio('https://www.soundjay.com/buttons/button-09.mp3'),
        end: new Audio('https://www.soundjay.com/buttons/button-10.mp3'),
        drink: new Audio('https://www.soundjay.com/buttons/button-3.mp3')
      };
      if (sounds[action]) {
        sounds[action].play().catch(() => {});
      }
    }
    
    // Event listeners
    document.getElementById('password').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        login();
      }
    });
    
    document.addEventListener('keydown', function(event) {
      if (event.ctrlKey && event.key === 'l' && document.getElementById('loginContainer').style.display !== 'none') {
        document.getElementById('email').focus();
      }
    });
    
    window.addEventListener('beforeunload', function(event) {
      saveData();
      if (Object.values(timers).some(timer => timer !== null)) {
        event.preventDefault();
        event.returnValue = 'يوجد غرف تعمل حاليًا، هل تريد المغادرة؟';
      }
    });
    
    // Auto-save and load
    setInterval(saveData, 60000);
    window.onload = checkLoginState;
  </script>
</body>
</html>
